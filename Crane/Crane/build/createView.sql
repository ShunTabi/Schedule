-- V_PRIOR
CREATE VIEW V_PRIOR AS
SELECT CODE AS PRIORID,NAME1 AS "PRIORNAME",NAME2 AS "PRIORSUBNAME",COMITEMUPDATEDATE "PRIORUPDATEDATE" FROM
T_COMITEM WHERE TABLEKIND = 'PRIOR' AND COMITEMVISIBLESTATUS = '0';
-- V_STATUS
CREATE VIEW V_STATUS AS
SELECT CODE AS STATUSID,NAME1 AS "STATUSNAME",NAME2 AS "STATUSSUBNAME",COMITEMUPDATEDATE "STATUSUPDATEDATE" FROM
T_COMITEM WHERE TABLEKIND = 'STATUS' AND COMITEMVISIBLESTATUS = '0';
-- V_GOAL
CREATE VIEW V_GOAL AS
SELECT * FROM T_GOAL
INNER JOIN T_GENRE USING(GENREID)
WHERE GENREVISIBLESTATUS = 0 AND GOALVISIBLESTATUS = 0;
-- V_PLAN
CREATE VIEW V_PLAN AS
SELECT * FROM T_PLAN
INNER JOIN T_GOAL USING(GOALID)
WHERE GOALVISIBLESTATUS = 0 AND PLANVISIBLESTATUS = 0;
-- V_WORK
CREATE VIEW V_WORK AS
SELECT * FROM T_WORK
INNER JOIN T_PLAN USING(PLANID)
INNER JOIN T_GOAL USING(GOALID)
INNER JOIN V_PRIOR ON T_WORK.PRIORID = V_PRIOR.PRIORID
WHERE GOALVISIBLESTATUS = 0 AND PLANVISIBLESTATUS = 0 AND WORKVISIBLESTATUS = 0;
-- V_SCHEDULE
CREATE VIEW V_SCHEDULE AS
SELECT T_SCHEDULE.SCHEDULEID,GOALID,GOALNAME,PLANID,PLANNAME,WORKID,WORKNAME,WORKENDDATE,PRIORID,PRIORNAME,PRIORSUBNAME,STATUSID,STATUSNAME,STATUSSUBNAME,strftime('%Y-%m',SCHEDULEDATE) AS SCHEDULEMONTH,SCHEDULEDATE,SCHEDULESTARTTIME,SCHEDULEENDTIME,strftime('%s',SCHEDULEENDTIME) - strftime('%s',SCHEDULESTARTTIME) AS MINS FROM T_SCHEDULE
INNER JOIN T_WORK USING (WORKID)
INNER JOIN T_PLAN USING (PLANID)
INNER JOIN T_GOAL USING (GOALID)
INNER JOIN V_STATUS USING (STATUSID)
INNER JOIN V_PRIOR USING (PRIORID)
WHERE SCHEDULEVISIBLESTATUS = 0;
-- V_BIN
CREATE VIEW V_BIN AS
SELECT 'GENRE' AS "KEY",GENREID AS "ID",GENRENAME AS "NAME",GENREUPDATEDATE AS "UPDATEDATE" FROM T_GENRE WHERE GENREVISIBLESTATUS = 1
UNION
SELECT 'GOAL',GOALID,GOALNAME,GOALUPDATEDATE FROM T_GOAL WHERE GOALVISIBLESTATUS = 1
UNION
SELECT 'PLAN',PLANID,PLANNAME,PLANUPDATEDATE FROM T_PLAN WHERE PLANVISIBLESTATUS = 1
UNION
SELECT 'WORK',WORKID,PLANNAME||'ãƒ»'||WORKNAME,WORKUPDATEDATE FROM T_WORK INNER JOIN T_PLAN USING(PLANID)
WHERE WORKVISIBLESTATUS = 1
UNION
SELECT 'SCHEDULE',SCHEDULEID,SCHEDULEDATE||WORKNAME||'('||SCHEDULESTARTTIME||'-'||SCHEDULEENDTIME||')',SCHEDULEUPDATEDATE FROM T_SCHEDULE
INNER JOIN T_WORK USING (WORKID) INNER JOIN T_PLAN USING (PLANID)
WHERE SCHEDULEVISIBLESTATUS = 1;
-- V_ST_MONTH
CREATE VIEW V_ST_MONTH AS
SELECT DISTINCT strftime('%Y-%m',SCHEDULEDATE) AS "MONTH" FROM T_SCHEDULE;
-- V_ST_SCHEDULE1
CREATE VIEW V_ST_SCHEDULE1 AS 
SELECT TABLE1.MONTH,V_SCHEDULE.SCHEDULEID,TABLE1.GOALID,TABLE1.GOALNAME,V_SCHEDULE.PLANID,V_SCHEDULE.PLANNAME,V_SCHEDULE.SCHEDULEDATE,V_SCHEDULE.SCHEDULESTARTTIME,V_SCHEDULE.SCHEDULEENDTIME,STATUSID,STATUSNAME,STATUSSUBNAME,CASE WHEN STATUSID=3 THEN MINS ELSE 0 END AS MINS FROM 
(
SELECT * FROM V_ST_MONTH LEFT OUTER JOIN (SELECT DISTINCT GOALID,GOALNAME FROM V_SCHEDULE) 
) AS TABLE1
LEFT OUTER JOIN V_SCHEDULE ON TABLE1.MONTH = V_SCHEDULE.SCHEDULEMONTH AND TABLE1.GOALID = V_SCHEDULE.GOALID;
-- V_ST_SCHEDULE2
CREATE VIEW V_ST_SCHEDULE2 AS 
SELECT MONTH,GOALID,GOALNAME,SUM(MINS)/60 AS MINS FROM V_ST_SCHEDULE1 GROUP BY MONTH,GOALID ORDER BY MONTH;